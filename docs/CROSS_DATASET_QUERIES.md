# Cross-Dataset Query Examples

This document contains 10 natural language queries that require joining data from multiple heterogeneous datasets. Each query demonstrates different orchestration challenges including schema matching, entity resolution, value normalization, and semantic alignment.

---

## Query 1: Client Financial Overview
**"Show me the total revenue and all active matters for each client in the Healthcare industry, including their contact information and the dates when each matter was opened."**

**Required Datasets:**
- `structured_clients_A.csv` (industry, annual_revenue, contact_phone)
- `structured_clients_B.json` (sector, financials.turnover, phone)
- `structured_clients_C.xml` (cat, annual_turnover, phone)
- `structured_clients_D.xlsx` (industry, revenue, phone)
- `matters_A.csv` (client_ref, practice_area, opened_on)
- `matters_B.json` (client_id, area, startDate)

**Challenges:**
- Schema matching: `industry` vs `sector` vs `cat`
- Value normalization: `annual_revenue` (formatted) vs `turnover` (numeric) vs `annual_turnover` (string)
- Date normalization: `opened_on` vs `startDate` with multiple formats
- Entity resolution: `client_id` vs `client_ref` vs `id` vs `cid`

---

## Query 2: Attorney Workload Analysis
**"Find all billing entries for matters handled by Daniel Park in the IP practice area, showing the client name, matter title, hours billed, and total amount charged, but also include any narrative descriptions from the billing files that mention these matters."**

**Required Datasets:**
- `matters_A.csv` (lead_attorney, practice_area, title, client_ref)
- `matters_B.json` (owner, area, matterSummary, client_id)
- `billing_entries_A.csv` (file_id, att_id, hours, rate, amount, description, entry_date)
- `billing_files/*.txt` (narrative summaries, noisy matter IDs, client name variations)
- `structured_clients_A.csv` (client_id, company_name)
- `structured_clients_B.json` (id, custFullNm)

**Challenges:**
- Entity resolution: `lead_attorney` vs `owner`
- ID matching: `file_id` → `matter_id` with potential aliases (MAT-1011 vs MTR-1010)
- Name matching: `company_name` vs `custFullNm` vs narrative variations
- Semantic matching: structured `description` vs narrative text descriptions

---

## Query 3: Document Discovery by Client
**"List all Contract documents created in 2023 for clients in the Technology sector, showing the document ID, client name, matter title, who uploaded it, and the full text content of each document."**

**Required Datasets:**
- `document_metadata.json` (doc_id, matter_id, client, doc_type, created, uploaded_by)
- `documents/*.txt` (full document text content)
- `matters_A.csv` (matter_id, title, client_ref)
- `matters_B.json` (file_no, matterSummary, client_id)
- `structured_clients_B.json` (id, sector, custFullNm)
- `structured_clients_A.csv` (client_id, industry, company_name)

**Challenges:**
- Date normalization: `created` field has formats like "15/08/24", "1650844800", "2020-08-30"
- Sector matching: `industry` = "Technology" vs `sector` = "technology"
- Document text retrieval: filename pattern matching (`D-{doc_id}_{file_type}.txt`)
- Entity resolution: `client` vs `client_id` vs `client_ref`

---

## Query 4: Revenue Reconciliation
**"Compare the annual revenue reported in the CSV client file with the turnover value in the JSON client file for all Finance industry clients, and flag any discrepancies greater than 10%."**

**Required Datasets:**
- `structured_clients_A.csv` (client_id, industry, annual_revenue)
- `structured_clients_B.json` (id, sector, financials.turnover)

**Challenges:**
- Currency normalization: `annual_revenue` = "$12,000,000" vs `turnover` = 12000000
- Industry matching: `industry` = "Finance" vs `sector` = "finance"
- Entity matching: `client_id` vs `id`
- Numeric parsing: strip currency symbols, commas, quotes

---

## Query 5: Matter Timeline with Billing Activity
**"Create a chronological timeline showing when each matter was opened, when billing entries were recorded, and when documents were uploaded, for all matters related to clients with revenue over $10 million."**

**Required Datasets:**
- `structured_clients_A.csv` (client_id, annual_revenue)
- `structured_clients_B.json` (id, financials.turnover)
- `matters_A.csv` (matter_id, client_ref, opened_on)
- `matters_B.json` (file_no, client_id, startDate)
- `billing_entries_A.csv` (file_id, entry_date)
- `document_metadata.json` (matter_id, created)

**Challenges:**
- Date format normalization across 4+ different formats
- Revenue threshold comparison across different formats
- Entity resolution: multiple client ID fields
- Temporal alignment: different date fields need unified format

---

## Query 6: Attorney Performance by Practice Area
**"Calculate the total hours and revenue generated by each attorney, grouped by practice area, using data from both the structured billing entries and the narrative billing files to ensure completeness."**

**Required Datasets:**
- `billing_entries_A.csv` (att_id, file_id, hours, rate, amount)
- `billing_files/*.txt` (embedded attorney IDs, hours, amounts in narrative)
- `matters_A.csv` (matter_id, practice_area, lead_attorney)
- `matters_B.json` (file_no, area, owner)

**Challenges:**
- Attorney ID extraction from narrative text
- Practice area matching: `practice_area` vs `area`
- Amount extraction from narrative (may be approximate)
- Entity resolution: `file_id` → `matter_id` with ID variations

---

## Query 7: Client Contact Information Consolidation
**"Find all unique phone numbers and creation dates for each client, combining information from all four client data sources (CSV, JSON, XML, XLSX), and identify any conflicts or missing values."**

**Required Datasets:**
- `structured_clients_A.csv` (client_id, contact_phone, created_at)
- `structured_clients_B.json` (id, phone, meta.registered_on)
- `structured_clients_C.xml` (cid, phone, registered_on)
- `structured_clients_D.xlsx` (cust_code, phone, created)

**Challenges:**
- Phone format normalization: "(555) 125-5506" vs "+1-555-338-9279" vs "555.489.2584"
- Date format normalization: multiple formats across sources
- Entity resolution: `client_id` vs `id` vs `cid` vs `cust_code`
- Conflict detection: same client with different phone numbers

---

## Query 8: Matter Documents with Email References
**"Find all matters that have both structured document metadata and email correspondence mentioning the matter, showing the matter title, client name, document count, and email subject lines."**

**Required Datasets:**
- `matters_A.csv` (matter_id, title, client_ref)
- `matters_B.json` (file_no, matterSummary, client_id)
- `document_metadata.json` (matter_id, doc_id)
- `emails_A.jsonl` (subject, body, related_matter_id - soft link via text)
- `structured_clients_A.csv` (client_id, company_name)

**Challenges:**
- Soft linking: email body text mentions matter IDs or titles
- Entity resolution: `matter_id` vs `file_no` vs email references
- Semantic matching: email subject may use different terminology than matter title
- Aggregation: count documents per matter

---

## Query 9: Regulatory Compliance Check
**"Identify all matters in the Regulatory practice area that reference specific regulations, showing the matter details, client information, and the full text of both the regulation and any related filings."**

**Required Datasets:**
- `matters_A.csv` (matter_id, practice_area, title, client_ref)
- `matters_B.json` (file_no, area, matterSummary, client_id)
- `regulations/*.txt` (regulation text content)
- `documents/filings/*.txt` (filing text content)
- `structured_clients_A.csv` (client_id, company_name, industry)

**Challenges:**
- Practice area matching: `practice_area` = "Regulatory" vs `area` = "Regulatory"
- Text search: regulation text may be referenced in matter titles or document content
- Filing association: filings linked to matters via matter_id
- Client context: need client info for compliance reporting

---

## Query 10: Complete Client Portfolio View
**"Generate a comprehensive portfolio report for a specific client showing: their company information from all sources, all matters they're involved in, total billing across all matters, all documents associated with those matters, and any email correspondence related to the client, with all dates normalized to a standard format."**

**Required Datasets:**
- `structured_clients_A.csv` (all client fields)
- `structured_clients_B.json` (all client fields)
- `structured_clients_C.xml` (all client fields)
- `structured_clients_D.xlsx` (all client fields)
- `matters_A.csv` (all matter fields)
- `matters_B.json` (all matter fields)
- `billing_entries_A.csv` (all billing fields)
- `document_metadata.json` (all document fields)
- `documents/*.txt` (document text)
- `billing_files/*.txt` (billing narratives)
- `emails_A.jsonl` (email content)

**Challenges:**
- **Complete entity resolution**: client ID matching across 4 formats
- **Schema fusion**: merge fields with different names but same meaning
- **Value normalization**: dates, currency, phone numbers across all sources
- **Semantic alignment**: client name variations across structured and narrative sources
- **Temporal consistency**: normalize all dates to single format
- **Aggregation**: sum billing amounts, count documents/matters
- **Soft linking**: email-to-client matching via text analysis
- **Data quality**: identify and reconcile conflicts across sources

---

## Query Orchestration Patterns

These queries demonstrate several common orchestration patterns:

1. **Schema Matching**: Mapping `client_id` → `id` → `cid` → `cust_code`
2. **Value Normalization**: Converting `"$12,000,000"` → `12000000` and `"15/09/22"` → `"2022-09-15"`
3. **Entity Resolution**: Linking `MAT-1011` with `MTR-1010` (same matter, different ID format)
4. **Semantic Matching**: "Stonebridge Motors Inc" ≈ "STONEBRIDGE MOTORS INC" ≈ "Stonebridge Motors Company"
5. **Soft Linking**: Email body text → matter/client via NLP
6. **Temporal Alignment**: Multiple date formats → unified timeline
7. **Aggregation Across Sources**: Sum billing from structured + narrative sources
8. **Conflict Detection**: Same entity with conflicting values across sources
9. **Text-to-Structured Join**: Narrative billing files → structured billing entries
10. **Multi-Format Fusion**: CSV + JSON + XML + XLSX → unified view

Each query requires a data orchestration pipeline that handles schema discovery, entity resolution, value normalization, and semantic alignment before performing the actual query logic.

